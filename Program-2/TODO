writing in filename is borked, see old commits
missing closing on FD 4
misalignment on copy into archive
